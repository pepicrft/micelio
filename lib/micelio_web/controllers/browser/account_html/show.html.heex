<Layouts.app
  flash={@flash}
  current_scope={assigns[:current_scope]}
  current_user={assigns[:current_user]}
>
  <div class="account-page">
    <.header>
      <%= if @organization do %>
        {@organization.name}
      <% else %>
        {@account.handle}
      <% end %>
      <:subtitle>
        <% social_links = MicelioWeb.ProfileLinks.social_links(@user) %>
        <div class="account-subtitle">
          <span class="account-handle">@{@account.handle}</span>
          <%= if @user && @user.bio && @user.bio != "" do %>
            <p class="account-bio">{@user.bio}</p>
          <% end %>
          <%= if @user && social_links != [] do %>
            <div class="account-social-links" aria-label="Social links">
              <%= for link <- social_links do %>
                <a
                  class="account-social-link"
                  href={link.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  aria-label={link.label}
                  data-tooltip={link.label}
                >
                  <.icon name={link.icon} class="account-social-icon" />
                </a>
              <% end %>
            </div>
          <% end %>
        </div>
      </:subtitle>
    </.header>

    <%= if @user do %>
      <section class="account-section" id="account-activity">
        <h2 class="account-section-title">Activity</h2>
        <.activity_graph activity_counts={@activity_counts} weeks={52} />
      </section>
    <% end %>

    <section class="account-section" id="account-owned-projects">
      <h2 class="account-section-title">{@projects_title}</h2>
      <%= if Enum.empty?(@projects) do %>
        <div class="account-empty">
          <p>{@empty_message}</p>
        </div>
      <% else %>
        <div class="account-projects" id="account-projects-list">
          <%= for project <- @projects do %>
            <article class="account-project" id={"account-project-#{project.id}"}>
              <h3 class="account-project-title">
                <a href={~p"/#{project.organization.account.handle}/#{project.handle}"}>
                  {project.name}
                </a>
              </h3>

              <div class="account-project-handle">
                {project.organization.account.handle}/{project.handle}
              </div>

              <%= if project.description do %>
                <p class="account-project-description">{project.description}</p>
              <% end %>

              <%= if project.url do %>
                <p class="account-project-url">
                  <a href={project.url} target="_blank" rel="noopener noreferrer">
                    {project.url}
                  </a>
                </p>
              <% end %>
            </article>
          <% end %>
        </div>
      <% end %>
    </section>
  </div>
</Layouts.app>
