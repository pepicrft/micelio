{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://micelio.dev/schemas/session-event.json",
  "title": "SessionEvent",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "type",
    "timestamp",
    "source",
    "payload"
  ],
  "properties": {
    "id": {
      "type": "string"
    },
    "type": {
      "type": "string",
      "enum": [
        "status",
        "progress",
        "output",
        "error",
        "artifact"
      ]
    },
    "timestamp": {
      "type": "string",
      "format": "date-time"
    },
    "source": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind"
      ],
      "properties": {
        "kind": {
          "type": "string",
          "enum": [
            "agent",
            "tool",
            "system",
            "user"
          ]
        },
        "id": {
          "type": "string"
        },
        "label": {
          "type": "string"
        },
        "metadata": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "payload": {
      "type": "object"
    }
  },
  "oneOf": [
    {
      "type": "object",
      "required": [
        "type",
        "payload"
      ],
      "properties": {
        "type": {
          "const": "status"
        },
        "payload": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "state"
          ],
          "properties": {
            "state": {
              "type": "string",
              "enum": [
                "queued",
                "running",
                "waiting",
                "completed",
                "failed",
                "canceled"
              ]
            },
            "message": {
              "type": "string"
            },
            "detail": {
              "type": "string"
            },
            "step": {
              "type": "string"
            },
            "percent": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            }
          }
        }
      }
    },
    {
      "type": "object",
      "required": [
        "type",
        "payload"
      ],
      "properties": {
        "type": {
          "const": "progress"
        },
        "payload": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "current",
            "total"
          ],
          "properties": {
            "current": {
              "type": "number",
              "minimum": 0
            },
            "total": {
              "type": "number",
              "minimum": 0
            },
            "unit": {
              "type": "string"
            },
            "message": {
              "type": "string"
            },
            "percent": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            }
          }
        }
      }
    },
    {
      "type": "object",
      "required": [
        "type",
        "payload"
      ],
      "properties": {
        "type": {
          "const": "output"
        },
        "payload": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "text"
          ],
          "properties": {
            "text": {
              "type": "string",
              "minLength": 1
            },
            "stream": {
              "type": "string",
              "enum": [
                "stdout",
                "stderr",
                "log"
              ]
            },
            "format": {
              "type": "string",
              "enum": [
                "text",
                "markdown",
                "ansi"
              ]
            }
          }
        }
      }
    },
    {
      "type": "object",
      "required": [
        "type",
        "payload"
      ],
      "properties": {
        "type": {
          "const": "error"
        },
        "payload": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "message"
          ],
          "properties": {
            "message": {
              "type": "string",
              "minLength": 1
            },
            "code": {
              "type": "string"
            },
            "retryable": {
              "type": "boolean"
            },
            "stacktrace": {
              "type": "string"
            },
            "metadata": {
              "type": "object",
              "additionalProperties": true
            }
          }
        }
      }
    },
    {
      "type": "object",
      "required": [
        "type",
        "payload"
      ],
      "properties": {
        "type": {
          "const": "artifact"
        },
        "payload": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "kind",
            "name",
            "uri"
          ],
          "properties": {
            "kind": {
              "type": "string",
              "enum": [
                "file",
                "image",
                "link",
                "dataset",
                "log"
              ]
            },
            "name": {
              "type": "string"
            },
            "uri": {
              "type": "string"
            },
            "content_type": {
              "type": "string"
            },
            "size_bytes": {
              "type": "integer",
              "minimum": 0
            },
            "metadata": {
              "type": "object",
              "additionalProperties": true
            }
          }
        }
      }
    }
  ]
}
